const express = require('express');
const path = require('path');
const fs = require('fs');
const bcrypt = require('bcrypt');
const session = require('express-session');
const cors = require('cors');

const app = express();
const PORT = process.env.PORT || 3000;

// Caminhos para arquivos de dados
const DADOS_DIR = path.join(__dirname, 'dados');
const USUARIOS_FILE = path.join(DADOS_DIR, 'usuarios.json');
const QUIZZES_FILE = path.join(DADOS_DIR, 'quizzes.json');
const QUIZZES_ARQUIVADOS_FILE = path.join(DADOS_DIR, 'quizzes_arquivados.json');
const QUIZZES_EXCLUIDOS_FILE = path.join(DADOS_DIR, 'quizzes_excluidos.json');
const PDFS_FILE = path.join(DADOS_DIR, 'pdfs.json');
const PDFS_EXCLUIDOS_FILE = path.join(DADOS_DIR, 'pdfs_excluidos.json');
const CADASTROS_FILE = path.join(DADOS_DIR, 'cadastros.json');

// MIDDLEWARE CORS CORRIGIDO
app.use(cors({
  origin: [
    'https://brainquiiz.netlify.app',      // ‚Üê SUA URL DO NETLIFY
    'https://brainquiz.netlify.app',
    'http://localhost:3000'
  ],
  credentials: true
}));

// Middleware para parsear JSON
app.use(express.json({limit: '50mb'}));
app.use(express.urlencoded({ extended: true, limit: '50mb' }));

// CONFIGURA√á√ÉO DE SESS√ÉO CORRIGIDA
app.use(session({
  secret: 'brainquiz-secret-2025-super-secure-final',
  resave: false,
  saveUninitialized: false,
  cookie: { 
    secure: false, // Para desenvolvimento (mudar para true em produ√ß√£o HTTPS)
    httpOnly: true,
    maxAge: 24 * 60 * 60 * 1000 // 24 horas
  },
  name: 'brainquiz.session'
}));

// Verificar e criar diret√≥rio de dados
if (!fs.existsSync(DADOS_DIR)) {
  fs.mkdirSync(DADOS_DIR, { recursive: true });
  console.log('üìÅ Diret√≥rio dados/ criado');
}

// MIDDLEWARE DE AUTENTICA√á√ÉO CORRIGIDO
function checkAuth(req, res, next) {
  console.log('üîê Verificando autentica√ß√£o...');
  console.log('Session ID:', req.sessionID);
  console.log('Session data:', req.session?.usuario ? 'Usu√°rio presente' : 'Sem usu√°rio');
  
  if (req.session && req.session.usuario && req.session.usuario.usuario) {
    console.log('‚úÖ Usu√°rio autenticado:', req.session.usuario.usuario);
    next();
  } else {
    console.log('‚ùå Usu√°rio n√£o autenticado');
    res.status(401).json({ 
      success: false, 
      message: 'N√£o autenticado',
      needsLogin: true 
    });
  }
}

// MIDDLEWARE PARA PERMISS√ïES
function checkAdmin(req, res, next) {
  if (req.session.usuario && req.session.usuario.tipo === 'administrador') {
    next();
  } else {
    res.status(403).json({ success: false, message: 'Acesso negado. Apenas administrador.' });
  }
}

function checkAdminOrModerator(req, res, next) {
  if (req.session.usuario && (req.session.usuario.tipo === 'administrador' || req.session.usuario.tipo === 'moderador')) {
    next();
  } else {
    res.status(403).json({ success: false, message: 'Acesso negado. Apenas admin ou moderador.' });
  }
}

// ROTA DE STATUS DO SERVIDOR
app.get('/', (req, res) => {
  res.json({
    success: true,
    message: 'üöÄ API BrainQuiz Final ativa!',
    timestamp: new Date().toISOString(),
    version: '3.0.0'
  });
});

app.get('/status', (req, res) => {
  res.json({
    success: true,
    message: 'Servidor online',
    timestamp: new Date().toISOString()
  });
});

// ===========================================
// ROTAS DE AUTENTICA√á√ÉO
// ===========================================

// LOGIN FINAL CORRIGIDO
app.post('/login', async (req, res) => {
  console.log('üîë Tentativa de login:', { usuario: req.body.usuario });
  
  const { usuario, senha } = req.body;

  if (!usuario || !senha) {
    console.log('‚ùå Dados incompletos');
    return res.json({ success: false, message: 'Usu√°rio e senha s√£o obrigat√≥rios' });
  }

  try {
    const usuarios = lerJSON(USUARIOS_FILE);
    console.log('üìö Total de usu√°rios:', usuarios.length);
    
    const user = usuarios.find(u => u.usuario === usuario);

    if (!user) {
      console.log('‚ùå Usu√°rio n√£o encontrado:', usuario);
      return res.json({ success: false, message: 'Usu√°rio n√£o encontrado' });
    }

    console.log('üë§ Usu√°rio encontrado:', {
      usuario: user.usuario,
      tipo: user.tipo,
      status: user.status,
      ativo: user.ativo
    });

    // Verificar senha
    let senhaValida = false;
    
    if (user.senha && user.senha.startsWith('$2b$')) {
      // Senha com hash bcrypt
      senhaValida = await bcrypt.compare(senha, user.senha);
    } else {
      // Senha em texto simples (compatibilidade)
      senhaValida = (senha === user.senha);
    }

    if (!senhaValida) {
      console.log('‚ùå Senha incorreta');
      return res.json({ success: false, message: 'Senha incorreta' });
    }

    if (user.status && user.status !== 'aprovado') {
      console.log('‚ùå Usu√°rio n√£o aprovado:', user.status);
      return res.json({ success: false, message: 'Aguardando aprova√ß√£o do administrador' });
    }

    if (user.ativo === false) {
      console.log('‚ùå Usu√°rio inativo');
      return res.json({ success: false, message: 'Usu√°rio inativo' });
    }

    // CRIAR SESS√ÉO
    req.session.usuario = {
      id: user.id,
      usuario: user.usuario,
      tipo: user.tipo,
      nome: user.nome || '',
      sobrenome: user.sobrenome || '',
      email: user.email || '',
      telefone: user.telefone || user.celular || '',
      fotoBase64: user.fotoBase64 || null
    };

    // Salvar sess√£o
    req.session.save((err) => {
      if (err) {
        console.error('‚ùå Erro ao salvar sess√£o:', err);
        return res.json({ success: false, message: 'Erro interno do servidor' });
      }

      console.log('‚úÖ Login bem-sucedido:', user.usuario, user.tipo);
      console.log('Session salva:', req.sessionID);

      res.json({ 
        success: true, 
        message: 'Login realizado com sucesso',
        usuario: req.session.usuario,
        sessionId: req.sessionID
      });
    });

  } catch (error) {
    console.error('‚ùå Erro no login:', error);
    res.json({ success: false, message: 'Erro interno do servidor' });
  }
});

// CADASTRO CORRIGIDO
app.post('/cadastro', async (req, res) => {
  console.log('üìù Novo cadastro pendente:', req.body);
  
  const { usuario, senha, nome, sobrenome, email, telefone, celular } = req.body;

  if (!usuario || !senha || !nome || !email) {
    return res.json({ success: false, message: 'Campos obrigat√≥rios: usu√°rio, senha, nome e email' });
  }

  try {
    // Verificar se j√° existe nos usu√°rios aprovados
    const usuarios = lerJSON(USUARIOS_FILE);
    if (usuarios.find(u => u.usuario === usuario)) {
      return res.json({ success: false, message: 'Este usu√°rio j√° existe' });
    }

    if (usuarios.find(u => u.email === email)) {
      return res.json({ success: false, message: 'Este email j√° est√° em uso' });
    }

    // Verificar se j√° existe nos cadastros pendentes
    const cadastrosPendentes = lerJSON(CADASTROS_FILE);
    if (cadastrosPendentes.find(c => c.usuario === usuario)) {
      return res.json({ success: false, message: 'Este usu√°rio j√° possui um cadastro pendente' });
    }

    if (cadastrosPendentes.find(c => c.email === email)) {
      return res.json({ success: false, message: 'Este email j√° possui um cadastro pendente' });
    }

    // Criar cadastro pendente
    const novoCadastro = {
      id: gerarId(),
      usuario: usuario.trim(),
      senha: await bcrypt.hash(senha, 10),
      nome: nome.trim(),
      sobrenome: (sobrenome || '').trim(),
      email: email.trim(),
      telefone: telefone || celular || '',
      tipo: 'aluno',
      status: 'pendente',
      ativo: false,
      dataCriacao: new Date().toISOString(),
      fotoBase64: null
    };

    cadastrosPendentes.push(novoCadastro);
    salvarJSON(CADASTROS_FILE, cadastrosPendentes);

    console.log('‚úÖ Cadastro pendente criado:', usuario);
    
    res.json({ 
      success: true, 
      message: 'Cadastro enviado para aprova√ß√£o!',
      needsApproval: true
    });
    
  } catch (error) {
    console.error('‚ùå Erro no cadastro:', error);
    res.json({ success: false, message: 'Erro interno do servidor' });
  }
});

// VERIFICAR USU√ÅRIO LOGADO
app.get('/usuario', (req, res) => {
  console.log('üîç Verificando usu√°rio da sess√£o...');
  console.log('Session ID:', req.sessionID);
  console.log('Session user:', req.session?.usuario?.usuario);
  
  if (req.session && req.session.usuario) {
    console.log('‚úÖ Usu√°rio encontrado na sess√£o:', req.session.usuario.usuario);
    res.json({
      success: true,
      usuario: req.session.usuario
    });
  } else {
    console.log('‚ùå Nenhum usu√°rio na sess√£o');
    res.status(401).json({
      success: false,
      message: 'Sess√£o n√£o encontrada',
      needsLogin: true
    });
  }
});

// LOGOUT
app.post('/logout', (req, res) => {
  console.log('üëã Fazendo logout...');
  
  req.session.destroy((err) => {
    if (err) {
      console.error('‚ùå Erro ao destruir sess√£o:', err);
      return res.json({ success: false, message: 'Erro ao fazer logout' });
    }
    
    console.log('‚úÖ Logout realizado');
    res.json({ success: true, message: 'Logout realizado com sucesso' });
  });
});

// ===========================================
// API DE DADOS
// ===========================================

// LISTAR USU√ÅRIOS
app.get('/api/usuarios', checkAuth, (req, res) => {
  try {
    const usuarios = lerJSON(USUARIOS_FILE).filter(u => u.status === 'aprovado');
    res.json({ success: true, usuarios });
  } catch (error) {
    console.error('‚ùå Erro ao listar usu√°rios:', error);
    res.json({ success: false, message: 'Erro ao carregar usu√°rios' });
  }
});

// LISTAR CADASTROS PENDENTES
app.get('/api/cadastros', checkAuth, (req, res) => {
  try {
    // Verificar permiss√£o
    if (!['administrador', 'moderador'].includes(req.session.usuario.tipo)) {
      return res.status(403).json({ success: false, message: 'Acesso negado' });
    }
    
    const cadastros = lerJSON(CADASTROS_FILE);
    console.log('üìã Cadastros pendentes:', cadastros.length);
    res.json({ success: true, cadastros });
  } catch (error) {
    console.error('‚ùå Erro ao listar cadastros:', error);
    res.json({ success: false, message: 'Erro ao carregar cadastros' });
  }
});

// APROVAR CADASTRO
app.post('/api/cadastros/:id/aprovar', checkAuth, (req, res) => {
  const cadastroId = req.params.id;
  console.log('‚úÖ Aprovando cadastro ID:', cadastroId);
  
  try {
    // Verificar permiss√£o
    if (!['administrador', 'moderador'].includes(req.session.usuario.tipo)) {
      return res.status(403).json({ success: false, message: 'Acesso negado' });
    }
    
    let cadastros = lerJSON(CADASTROS_FILE);
    const cadastroIdx = cadastros.findIndex(c => c.id == cadastroId);
    
    if (cadastroIdx === -1) {
      return res.json({ success: false, message: 'Cadastro n√£o encontrado' });
    }

    const cadastro = cadastros[cadastroIdx];
    
    // Mover para usu√°rios
    let usuarios = lerJSON(USUARIOS_FILE);
    
    const novoUsuario = {
      id: cadastro.id,
      usuario: cadastro.usuario,
      senha: cadastro.senha, // J√° est√° hasheada
      nome: cadastro.nome,
      sobrenome: cadastro.sobrenome,
      email: cadastro.email,
      telefone: cadastro.telefone,
      tipo: 'aluno',
      status: 'aprovado',
      ativo: true,
      dataCriacao: cadastro.dataCriacao,
      dataAprovacao: new Date().toISOString(),
      aprovadoPor: req.session.usuario.usuario,
      fotoBase64: cadastro.fotoBase64
    };
    
    usuarios.push(novoUsuario);
    cadastros.splice(cadastroIdx, 1);
    
    salvarJSON(USUARIOS_FILE, usuarios);
    salvarJSON(CADASTROS_FILE, cadastros);
    
    console.log('‚úÖ Cadastro aprovado:', cadastro.usuario);
    res.json({ success: true, message: 'Cadastro aprovado com sucesso' });
    
  } catch (error) {
    console.error('‚ùå Erro ao aprovar cadastro:', error);
    res.json({ success: false, message: 'Erro interno do servidor' });
  }
});

// REJEITAR CADASTRO
app.delete('/api/cadastros/:id', checkAuth, (req, res) => {
  const cadastroId = req.params.id;
  console.log('‚ùå Rejeitando cadastro ID:', cadastroId);
  
  try {
    // Verificar permiss√£o
    if (!['administrador', 'moderador'].includes(req.session.usuario.tipo)) {
      return res.status(403).json({ success: false, message: 'Acesso negado' });
    }
    
    let cadastros = lerJSON(CADASTROS_FILE);
    const idx = cadastros.findIndex(c => c.id == cadastroId);
    
    if (idx === -1) {
      return res.json({ success: false, message: 'Cadastro n√£o encontrado' });
    }

    cadastros.splice(idx, 1);
    salvarJSON(CADASTROS_FILE, cadastros);
    
    console.log('‚úÖ Cadastro rejeitado');
    res.json({ success: true, message: 'Cadastro rejeitado com sucesso' });
    
  } catch (error) {
    console.error('‚ùå Erro ao rejeitar cadastro:', error);
    res.json({ success: false, message: 'Erro interno do servidor' });
  }
});

// EDITAR USU√ÅRIO
app.put('/api/usuarios/:usuario', checkAuth, checkAdminOrModerator, async (req, res) => {
  const usuarioTarget = req.params.usuario;
  const { nome, sobrenome, email, telefone, tipo } = req.body;
  
  let usuarios = lerJSON(USUARIOS_FILE);
  const idx = usuarios.findIndex(u => u.usuario === usuarioTarget);
  
  if (idx === -1) {
    return res.json({ success: false, message: 'Usu√°rio n√£o encontrado' });
  }

  // Verificar permiss√µes para alterar tipo
  if (tipo && usuarios[idx].tipo !== tipo) {
    if (req.session.usuario.tipo !== 'administrador') {
      return res.json({ success: false, message: 'Apenas administradores podem alterar o tipo de usu√°rio' });
    }
  }

  // Atualizar dados
  if (nome) usuarios[idx].nome = nome;
  if (sobrenome !== undefined) usuarios[idx].sobrenome = sobrenome;
  if (email) usuarios[idx].email = email;
  if (telefone !== undefined) usuarios[idx].telefone = telefone;
  if (tipo && req.session.usuario.tipo === 'administrador') usuarios[idx].tipo = tipo;

  salvarJSON(USUARIOS_FILE, usuarios);
  res.json({ success: true, message: 'Usu√°rio atualizado com sucesso' });
});

// ALTERAR ROLE (PROMOVER/REBAIXAR)
app.post('/alterar-role', checkAuth, checkAdmin, async (req, res) => {
  const { usuario, role } = req.body;
  
  if (!usuario || !role) {
    return res.json({ success: false, message: 'Usu√°rio e role s√£o obrigat√≥rios' });
  }
  
  if (!['aluno', 'moderador', 'administrador'].includes(role)) {
    return res.json({ success: false, message: 'Role inv√°lido' });
  }
  
  let usuarios = lerJSON(USUARIOS_FILE);
  const idx = usuarios.findIndex(u => u.usuario === usuario);
  
  if (idx === -1) {
    return res.json({ success: false, message: 'Usu√°rio n√£o encontrado' });
  }
  
  if (usuario === req.session.usuario.usuario) {
    return res.json({ success: false, message: 'Voc√™ n√£o pode alterar seu pr√≥prio tipo' });
  }
  
  usuarios[idx].tipo = role;
  usuarios[idx].dataAlteracao = new Date().toISOString();
  
  salvarJSON(USUARIOS_FILE, usuarios);
  res.json({ success: true, message: `Usu√°rio ${usuario} alterado para ${role}` });
});

// EXCLUIR USU√ÅRIO
app.post('/excluir-usuario', checkAuth, checkAdmin, (req, res) => {
  const { usuario } = req.body;
  
  if (!usuario) {
    return res.json({ success: false, message: 'Usu√°rio √© obrigat√≥rio' });
  }
  
  if (usuario === req.session.usuario.usuario) {
    return res.json({ success: false, message: 'Voc√™ n√£o pode excluir seu pr√≥prio usu√°rio' });
  }
  
  let usuarios = lerJSON(USUARIOS_FILE);
  const idx = usuarios.findIndex(u => u.usuario === usuario);
  
  if (idx === -1) {
    return res.json({ success: false, message: 'Usu√°rio n√£o encontrado' });
  }
  
  usuarios.splice(idx, 1);
  salvarJSON(USUARIOS_FILE, usuarios);
  
  res.json({ success: true, message: 'Usu√°rio exclu√≠do com sucesso' });
});

// LISTAR QUIZZES
app.get('/api/quizzes', checkAuth, (req, res) => {
  try {
    const quizzes = lerJSON(QUIZZES_FILE);
    res.json({ success: true, quizzes });
  } catch (error) {
    console.error('‚ùå Erro ao listar quizzes:', error);
    res.json({ success: false, message: 'Erro ao carregar quizzes' });
  }
});

// SALVAR QUIZ
app.post('/api/quizzes', checkAuth, checkAdminOrModerator, (req, res) => {
  try {
    const quiz = req.body;

    if (!quiz || !quiz.nome || !quiz.perguntas || !Array.isArray(quiz.perguntas)) {
      return res.json({ success: false, message: 'Dados do quiz incompletos' });
    }

    const quizzes = lerJSON(QUIZZES_FILE);

    // Se √© edi√ß√£o
    if (quiz.id) {
      const idx = quizzes.findIndex(q => q.id === quiz.id);
      if (idx !== -1) {
        quizzes[idx] = {
          ...quiz,
          dataModificacao: new Date().toISOString(),
          modificadoPor: req.session.usuario.usuario
        };
        salvarJSON(QUIZZES_FILE, quizzes);
        return res.json({ success: true, message: 'Quiz atualizado com sucesso' });
      }
    }

    // Novo quiz
    if (quizzes.some(q => q.nome === quiz.nome)) {
      return res.json({ success: false, message: 'J√° existe um quiz com este nome' });
    }

    quiz.id = gerarId();
    quiz.criadoPor = req.session.usuario.usuario;
    quiz.dataCriacao = new Date().toISOString();

    quizzes.push(quiz);
    salvarJSON(QUIZZES_FILE, quizzes);

    res.json({ success: true, message: 'Quiz salvo com sucesso' });
    
  } catch (error) {
    console.error('‚ùå Erro ao salvar quiz:', error);
    res.json({ success: false, message: 'Erro interno do servidor' });
  }
});

// ATUALIZAR PERFIL
app.put('/api/perfil', checkAuth, async (req, res) => {
  const { nome, sobrenome, email, telefone, fotoBase64, senhaAtual } = req.body;
  
  if (!senhaAtual) {
    return res.json({ success: false, message: 'Senha atual √© obrigat√≥ria para salvar altera√ß√µes' });
  }

  let usuarios = lerJSON(USUARIOS_FILE);
  const idx = usuarios.findIndex(u => u.usuario === req.session.usuario.usuario);
  
  if (idx === -1) {
    return res.json({ success: false, message: 'Usu√°rio n√£o encontrado' });
  }

  // Verificar senha atual
  const user = usuarios[idx];
  let senhaValida = false;
  
  try {
    if (user.senha && user.senha.startsWith('$2b$')) {
      senhaValida = await bcrypt.compare(senhaAtual, user.senha);
    } else {
      senhaValida = (senhaAtual === user.senha);
    }
  } catch (error) {
    return res.json({ success: false, message: 'Erro ao verificar senha' });
  }

  if (!senhaValida) {
    return res.json({ success: false, message: 'Senha atual incorreta' });
  }

  // Atualizar dados
  if (nome) usuarios[idx].nome = nome;
  if (sobrenome !== undefined) usuarios[idx].sobrenome = sobrenome;
  if (email) usuarios[idx].email = email;
  if (telefone !== undefined) usuarios[idx].telefone = telefone;
  if (fotoBase64 !== undefined) usuarios[idx].fotoBase64 = fotoBase64;

  salvarJSON(USUARIOS_FILE, usuarios);

  // Atualizar sess√£o
  req.session.usuario = {
    ...req.session.usuario,
    nome: usuarios[idx].nome,
    sobrenome: usuarios[idx].sobrenome,
    email: usuarios[idx].email,
    telefone: usuarios[idx].telefone,
    fotoBase64: usuarios[idx].fotoBase64
  };

  res.json({ success: true, message: 'Perfil atualizado com sucesso' });
});

// ===========================================
// FUN√á√ïES AUXILIARES
// ===========================================

function lerJSON(caminho) {
  try {
    if (!fs.existsSync(caminho)) {
      salvarJSON(caminho, []);
      return [];
    }
    const dados = fs.readFileSync(caminho, 'utf8');
    return JSON.parse(dados);
  } catch (error) {
    console.error(`‚ùå Erro ao ler ${caminho}:`, error);
    return [];
  }
}

function salvarJSON(caminho, dados) {
  try {
    fs.writeFileSync(caminho, JSON.stringify(dados, null, 2), 'utf8');
  } catch (error) {
    console.error(`‚ùå Erro ao salvar ${caminho}:`, error);
  }
}

function gerarId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
}

// Middleware de erro 404
app.use((req, res) => {
  res.status(404).json({
    success: false,
    message: 'Endpoint n√£o encontrado',
    path: req.path
  });
});

// ===========================================
// INICIALIZA√á√ÉO DO SERVIDOR
// ===========================================

app.listen(PORT, async () => {
  console.log('üöÄ Servidor BrainQuiz FINAL rodando na porta:', PORT);
  console.log('üîó URL:', `http://localhost:${PORT}`);
  
  // Criar usu√°rio admin se n√£o existir
  try {
    let usuarios = lerJSON(USUARIOS_FILE);
    
    let adminExiste = usuarios.find(u => u.usuario === 'admin');
    
    if (!adminExiste) {
      console.log('üìù Criando usu√°rio admin inicial...');
      const novoAdmin = {
        id: Date.now(),
        usuario: 'admin',
        nome: 'Administrador',
        sobrenome: 'Sistema',
        email: 'admin@brainquiz.com',
        telefone: '11999999999',
        senha: await bcrypt.hash('1574569810', 10),
        tipo: 'administrador',
        status: 'aprovado',
        ativo: true,
        dataCriacao: new Date().toISOString(),
        fotoBase64: null
      };
      
      usuarios.push(novoAdmin);
      salvarJSON(USUARIOS_FILE, usuarios);
      console.log('‚úÖ Admin criado: admin / 1574569810');
    }
    
    // Estat√≠sticas
    const usuariosAtivos = usuarios.filter(u => u.status === 'aprovado' && u.ativo);
    const cadastrosPendentes = lerJSON(CADASTROS_FILE);
    const quizzes = lerJSON(QUIZZES_FILE);
    
    console.log('');
    console.log('üìä ESTAT√çSTICAS DO SISTEMA:');
    console.log('‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê');
    console.log('‚îÇ Usu√°rios ativos         ‚îÇ', usuariosAtivos.length.toString().padStart(7), '‚îÇ');
    console.log('‚îÇ Cadastros pendentes     ‚îÇ', cadastrosPendentes.length.toString().padStart(7), '‚îÇ');
    console.log('‚îÇ Quizzes dispon√≠veis     ‚îÇ', quizzes.length.toString().padStart(7), '‚îÇ');
    console.log('‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò');
    console.log('');
    console.log('üîë LOGIN DE TESTE: admin / 1574569810');
    console.log('‚úÖ Sistema FINAL funcionando perfeitamente!');
    console.log('üîß Sess√µes configuradas corretamente');
    console.log('üåê CORS configurado para produ√ß√£o e desenvolvimento');
    console.log('üõ°Ô∏è Todas as permiss√µes implementadas');
    console.log('üì± Compat√≠vel com dispositivos m√≥veis');
    
  } catch (error) {
    console.error('‚ùå Erro na inicializa√ß√£o:', error);
  }
});
